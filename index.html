<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SSL æ†‘è­‰æª¢æŸ¥å·¥å…·ç”¢ç”Ÿå™¨ v2.1</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', 'Microsoft JhengHei', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 40px;
            text-align: center;
        }
        .header h1 { font-size: 32px; margin-bottom: 10px; }
        .header p { opacity: 0.9; font-size: 16px; }
        .version-badge {
            display: inline-block;
            background: rgba(255,255,255,0.2);
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 12px;
            margin-top: 10px;
        }
        .content { padding: 40px; }
        .alert {
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 25px;
        }
        .alert-warning {
            background: linear-gradient(135deg, #fff3cd 0%, #ffeaa7 100%);
            border: 2px solid #ffc107;
            color: #856404;
        }
        .alert-info {
            background: linear-gradient(135deg, #d1ecf1 0%, #bee5eb 100%);
            border: 2px solid #17a2b8;
            color: #0c5460;
        }
        .alert h3 { margin-bottom: 12px; font-size: 18px; }
        .alert ul { margin: 10px 0 10px 25px; }
        .alert li { margin: 6px 0; line-height: 1.5; }
        .input-section {
            background: #f8f9fa;
            padding: 30px;
            border-radius: 15px;
            margin-bottom: 25px;
            border: 2px solid #e0e0e0;
        }
        .input-section h2 { color: #333; margin-bottom: 20px; font-size: 22px; }
        .form-group { margin-bottom: 20px; }
        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #555;
            font-weight: 600;
        }
        .form-group textarea, .form-group input {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 10px;
            font-size: 14px;
            transition: border-color 0.3s;
        }
        .form-group textarea {
            min-height: 120px;
            font-family: 'Courier New', monospace;
            resize: vertical;
        }
        .form-group textarea:focus, .form-group input:focus {
            outline: none;
            border-color: #667eea;
        }
        .form-group small { display: block; margin-top: 6px; color: #666; font-size: 13px; }
        .button-section {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 25px;
        }
        .btn {
            color: white;
            border: none;
            padding: 15px 25px;
            font-size: 15px;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 600;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        .btn:hover { transform: translateY(-2px); }
        .btn-download {
            background: linear-gradient(135deg, #4caf50 0%, #45a049 100%);
            box-shadow: 0 4px 15px rgba(76, 175, 80, 0.4);
        }
        .btn-copy {
            background: linear-gradient(135deg, #2196F3 0%, #1976D2 100%);
            box-shadow: 0 4px 15px rgba(33, 150, 243, 0.4);
        }
        .btn-view {
            background: linear-gradient(135deg, #FF9800 0%, #F57C00 100%);
            box-shadow: 0 4px 15px rgba(255, 152, 0, 0.4);
        }
        .status-message {
            padding: 12px 18px;
            border-radius: 10px;
            margin: 15px 0;
            display: none;
            font-weight: 500;
        }
        .status-success { background: #d4edda; border: 2px solid #c3e6cb; color: #155724; }
        .status-error { background: #f8d7da; border: 2px solid #f5c6cb; color: #721c24; }
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0; top: 0;
            width: 100%; height: 100%;
            background-color: rgba(0,0,0,0.5);
        }
        .modal-content {
            background-color: #fefefe;
            margin: 3% auto;
            padding: 25px;
            border-radius: 15px;
            width: 95%;
            max-width: 900px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }
        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }
        .close:hover { color: #333; }
        .modal h2 { color: #333; margin-bottom: 15px; }
        .modal textarea {
            width: 100%;
            height: 450px;
            font-family: 'Consolas', monospace;
            font-size: 12px;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            resize: vertical;
        }
        .footer {
            background: #f8f9fa;
            padding: 20px;
            text-align: center;
            color: #666;
            border-top: 2px solid #e0e0e0;
        }
        @media (max-width: 768px) {
            .header h1 { font-size: 24px; }
            .content { padding: 20px; }
            .button-section { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ”§ SSL æ†‘è­‰æª¢æŸ¥å·¥å…·ç”¢ç”Ÿå™¨</h1>
            <p>ç”¢ç”Ÿ PowerShell è…³æœ¬é€²è¡Œ SSL æ†‘è­‰æª¢æŸ¥ï¼Œè¼¸å‡ºç¾è§€çš„ HTML å ±å‘Š</p>
            <span class="version-badge">Version 2.1 - Simplified</span>
        </div>
        
        <div class="content">
            <div class="alert alert-warning">
                <h3>âš ï¸ ä½¿ç”¨èªªæ˜</h3>
                <ul>
                    <li>æœ¬å·¥å…·ç”¢ç”Ÿ PowerShell è…³æœ¬ï¼Œéœ€åœ¨ Windows ç’°å¢ƒåŸ·è¡Œ</li>
                    <li>åŸ·è¡Œå‰è«‹å…ˆåŸ·è¡Œï¼š<code>Set-ExecutionPolicy -ExecutionPolicy Bypass -Scope Process</code></li>
                    <li>è…³æœ¬æœƒè‡ªå‹•ç”¢ç”Ÿ HTML å ±å‘Šä¸¦åœ¨ç€è¦½å™¨ä¸­é–‹å•Ÿ</li>
                </ul>
            </div>

            <div class="input-section">
                <h2>ğŸ“‹ è¨­å®šæª¢æŸ¥åƒæ•¸</h2>
                
                <div class="form-group">
                    <label for="websites">ç¶²ç«™æ¸…å–®ï¼ˆæ¯è¡Œä¸€å€‹ç¶²å€ï¼‰</label>
                    <textarea id="websites" placeholder="https://example.com/">https://esvc.fnp.gov.tw/
https://www.fnp.gov.tw/
https://webjop.fnp.gov.tw/
https://pts.fnp.gov.tw/APNPA/
https://pms.fnp.gov.tw/
https://iesextmail1.fnp.gov.tw/</textarea>
                    <small>è«‹è¼¸å…¥å®Œæ•´çš„ HTTPS URLï¼Œæ¯è¡Œä¸€å€‹</small>
                </div>
                
                <div class="form-group">
                    <label for="warningDays">è­¦å‘Šå¤©æ•¸é–¾å€¼</label>
                    <input type="number" id="warningDays" value="60" min="1" max="365">
                    <small>æ†‘è­‰å‰©é¤˜å¤©æ•¸å°‘æ–¼æ­¤å€¼æ™‚æ¨™ç¤ºç‚ºè­¦å‘Šï¼ˆå»ºè­° 30-90 å¤©ï¼‰</small>
                </div>

                <div class="button-section">
                    <button class="btn btn-download" onclick="downloadScript()">ğŸ“¥ ä¸‹è¼‰è…³æœ¬</button>
                    <button class="btn btn-copy" onclick="copyScript()">ğŸ“‹ è¤‡è£½è…³æœ¬</button>
                    <button class="btn btn-view" onclick="viewScript()">ğŸ‘ï¸ æª¢è¦–è…³æœ¬</button>
                </div>

                <div id="statusMessage" class="status-message"></div>
            </div>

            <div class="alert alert-info">
                <h3>ğŸ“ è¼¸å‡ºæª”æ¡ˆ</h3>
                <ul>
                    <li><strong>HTML å ±å‘Šï¼š</strong>ssl_report_YYYYMMDD_HHMMSS.htmlï¼ˆå«äº’å‹•å¼åœ–è¡¨ï¼‰</li>
                    <li><strong>CSV è³‡æ–™ï¼š</strong>ssl_results_YYYYMMDD_HHMMSS.csvï¼ˆå¯ç”¨æ–¼ Excelï¼‰</li>
                </ul>
            </div>
        </div>
        
        <div class="footer">
            <p>Â© 2025 SSL æ†‘è­‰æª¢æŸ¥å·¥å…· | Version 2.1</p>
        </div>
    </div>

    <div id="scriptModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal()">&times;</span>
            <h2>PowerShell è…³æœ¬å…§å®¹</h2>
            <textarea id="scriptTextarea" readonly></textarea>
            <div style="text-align: center; margin-top: 15px;">
                <button onclick="copyFromModal()" class="btn btn-copy">ğŸ“‹ è¤‡è£½å…§å®¹</button>
                <button onclick="closeModal()" class="btn btn-view" style="margin-left: 10px;">é—œé–‰</button>
            </div>
        </div>
    </div>

    <script>
function generateScript() {
    const websites = document.getElementById('websites').value.trim().split('\n').filter(u => u.trim());
    const warningDays = document.getElementById('warningDays').value;
    const websitesList = websites.map(u => `    "${u.trim()}"`).join(',\n');
    
    return `# SSL Certificate Check Script v2.1
# ==================== è¨­å®š ====================
$websiteList = @(
${websitesList}
)
$warningDays = ${warningDays}
$workingDir = if ($PSScriptRoot) { $PSScriptRoot } else { $PWD.Path }

Write-Host ""
Write-Host "========================================" -ForegroundColor Cyan
Write-Host "SSL Certificate Check Script v2.1" -ForegroundColor Cyan
Write-Host "========================================" -ForegroundColor Cyan
Write-Host "Working Directory: $workingDir"
Write-Host "Sites to check: $($websiteList.Count)"
Write-Host "Warning threshold: $warningDays days"
Write-Host ""

# ==================== å‡½æ•¸ ====================
function Get-CertInfo {
    param ([string]$Url)
    try {
        $uri = [System.Uri]$Url
        $hostname = $uri.Host
        [Net.ServicePointManager]::SecurityProtocol = [Net.SecurityProtocolType]::Tls12 -bor [Net.SecurityProtocolType]::Tls13
        
        $req = [Net.HttpWebRequest]::Create($Url)
        $req.Timeout = 15000
        $req.AllowAutoRedirect = $false
        $req.Method = "HEAD"
        
        try { $req.GetResponse().Close() } catch { }
        
        $cert = $req.ServicePoint.Certificate
        if ($null -eq $cert) { throw "ç„¡æ³•å–å¾—æ†‘è­‰" }
        
        $cert2 = [Security.Cryptography.X509Certificates.X509Certificate2]$cert
        $days = [math]::Floor(($cert2.NotAfter - (Get-Date)).TotalDays)
        
        $subjectCN = if ($cert2.Subject -match "CN=([^,]+)") { $matches[1] } else { "N/A" }
        $issuerCN = if ($cert2.Issuer -match "CN=([^,]+)") { $matches[1] } else { "N/A" }
        $keySize = try { $cert2.PublicKey.Key.KeySize } catch { 0 }
        
        return [PSCustomObject]@{
            Url = $Url; Hostname = $hostname
            SubjectCN = $subjectCN; IssuerCN = $issuerCN
            NotBefore = $cert2.NotBefore; NotAfter = $cert2.NotAfter
            DaysRemaining = $days; Thumbprint = $cert2.Thumbprint
            KeySize = $keySize; SignatureAlgorithm = $cert2.SignatureAlgorithm.FriendlyName
            Status = if ($days -le 0) { "EXPIRED" } elseif ($days -le $warningDays) { "WARNING" } else { "OK" }
        }
    }
    catch {
        return [PSCustomObject]@{
            Url = $Url; Hostname = try { ([System.Uri]$Url).Host } catch { $Url }
            SubjectCN = "ERROR"; IssuerCN = "N/A"
            NotBefore = Get-Date; NotAfter = Get-Date
            DaysRemaining = -999; Thumbprint = "N/A"
            KeySize = 0; SignatureAlgorithm = "N/A"; Status = "ERROR"
        }
    }
}

function New-HtmlReport {
    param ([array]$Results, [string]$Path, [int]$Threshold)
    
    $ts = Get-Date -Format 'yyyy-MM-dd HH:mm:ss'
    $total = $Results.Count
    $expired = ($Results | Where-Object { $_.Status -eq 'EXPIRED' }).Count
    $warning = ($Results | Where-Object { $_.Status -eq 'WARNING' }).Count
    $ok = ($Results | Where-Object { $_.Status -eq 'OK' }).Count
    $error = ($Results | Where-Object { $_.Status -eq 'ERROR' }).Count
    $rate = if ($total -gt 0) { [math]::Round((($total - $error) / $total) * 100, 1) } else { 0 }
    $health = if (($expired + $warning) -eq 0) { 'è‰¯å¥½' } elseif (($expired + $warning) -le 2) { 'æ³¨æ„' } else { 'è­¦å‘Š' }
    
    $r1 = ($Results | Where-Object { $_.DaysRemaining -lt 0 -and $_.DaysRemaining -ne -999 }).Count
    $r2 = ($Results | Where-Object { $_.DaysRemaining -ge 0 -and $_.DaysRemaining -le 7 }).Count
    $r3 = ($Results | Where-Object { $_.DaysRemaining -gt 7 -and $_.DaysRemaining -le 30 }).Count
    $r4 = ($Results | Where-Object { $_.DaysRemaining -gt 30 -and $_.DaysRemaining -le 90 }).Count
    $r5 = ($Results | Where-Object { $_.DaysRemaining -gt 90 }).Count
    
    $rows = ""
    foreach ($r in $Results) {
        $sc = switch ($r.Status) { 'EXPIRED' {'status-expired'} 'WARNING' {'status-warning'} 'OK' {'status-ok'} default {'status-error'} }
        $exp = if ($r.Status -eq 'ERROR') { 'N/A' } else { $r.NotAfter.ToString('yyyy-MM-dd') }
        $d = if ($r.DaysRemaining -eq -999) { 'N/A' } else { $r.DaysRemaining }
        $ks = if ($r.Status -eq 'ERROR') { 'N/A' } else { "$($r.KeySize) bits" }
        $rows += "<tr><td><a href='$($r.Url)' target='_blank'>$($r.Hostname)</a></td><td><span class='badge $sc'>$($r.Status)</span></td><td>$d</td><td>$exp</td><td>$($r.SubjectCN)</td><td>$($r.IssuerCN)</td><td>$ks</td></tr>`n"
    }
    
    $html = @"
<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>SSL æ†‘è­‰å ±å‘Š - $ts</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:'Segoe UI','Microsoft JhengHei',sans-serif;background:#f0f2f5;padding:20px}
.container{max-width:1200px;margin:0 auto;background:#fff;border-radius:12px;box-shadow:0 4px 20px rgba(0,0,0,0.1);overflow:hidden}
.header{background:linear-gradient(135deg,#667eea,#764ba2);color:#fff;padding:25px;text-align:center}
.header h1{font-size:28px;margin-bottom:8px}
.content{padding:25px}
.cards{display:grid;grid-template-columns:repeat(auto-fit,minmax(150px,1fr));gap:15px;margin-bottom:25px}
.card{padding:20px;border-radius:10px;text-align:center;color:#fff}
.card h3{font-size:32px;margin-bottom:5px}
.card p{font-size:12px;text-transform:uppercase;opacity:0.9}
.card-expired{background:linear-gradient(135deg,#ff6b6b,#ee5a6f)}
.card-warning{background:linear-gradient(135deg,#feca57,#ff9f43)}
.card-ok{background:linear-gradient(135deg,#48dbfb,#0abde3)}
.card-error{background:linear-gradient(135deg,#a4b0be,#747d8c)}
.stats{background:#e8f4fd;padding:15px;border-radius:10px;margin-bottom:25px;display:grid;grid-template-columns:repeat(auto-fit,minmax(120px,1fr));gap:10px;text-align:center}
.stats div{background:#fff;padding:12px;border-radius:8px}
.stats h4{color:#2196F3;font-size:12px;margin-bottom:5px}
.stats p{font-size:20px;font-weight:bold;color:#333}
.charts{display:grid;grid-template-columns:1fr 1fr;gap:20px;margin-bottom:25px}
.chart-box{background:#f8f9fa;padding:20px;border-radius:10px}
.chart-box h3{text-align:center;margin-bottom:15px;color:#333;font-size:16px}
table{width:100%;border-collapse:collapse;font-size:13px}
thead{background:linear-gradient(135deg,#667eea,#764ba2);color:#fff}
th,td{padding:10px 8px;text-align:left;border-bottom:1px solid #eee}
tbody tr:hover{background:#f8f9fa}
.badge{display:inline-block;padding:3px 10px;border-radius:12px;font-size:11px;font-weight:bold;color:#fff}
.status-expired{background:#ff4757}
.status-warning{background:#ffa502}
.status-ok{background:#26de81}
.status-error{background:#a4b0be}
.footer{background:#f8f9fa;padding:15px;text-align:center;color:#666;font-size:12px}
.print-btn{position:fixed;top:15px;right:15px;background:#667eea;color:#fff;border:none;padding:10px 18px;border-radius:20px;cursor:pointer;font-size:13px}
@media print{.print-btn{display:none}}
@media(max-width:768px){.charts{grid-template-columns:1fr}}
</style>
</head>
<body>
<button class="print-btn" onclick="window.print()">ğŸ–¨ï¸ åˆ—å°</button>
<div class="container">
<div class="header"><h1>ğŸ”’ SSL æ†‘è­‰æª¢æŸ¥å ±å‘Š</h1><p>$ts | å…± $total å€‹ç¶²ç«™ | è­¦å‘Šé–¾å€¼ $Threshold å¤©</p></div>
<div class="content">
<div class="cards">
<div class="card card-expired"><h3>$expired</h3><p>å·²éæœŸ</p></div>
<div class="card card-warning"><h3>$warning</h3><p>å³å°‡éæœŸ</p></div>
<div class="card card-ok"><h3>$ok</h3><p>æ­£å¸¸</p></div>
<div class="card card-error"><h3>$error</h3><p>æª¢æŸ¥å¤±æ•—</p></div>
</div>
<div class="stats">
<div><h4>ç¸½æª¢æŸ¥æ•¸</h4><p>$total</p></div>
<div><h4>æˆåŠŸç‡</h4><p>$rate%</p></div>
<div><h4>éœ€æ³¨æ„</h4><p>$($expired+$warning)</p></div>
<div><h4>å¥åº·ç‹€æ…‹</h4><p>$health</p></div>
</div>
<div class="charts">
<div class="chart-box"><h3>ç‹€æ…‹åˆ†å¸ƒ</h3><canvas id="c1"></canvas></div>
<div class="chart-box"><h3>åˆ°æœŸæ™‚é–“åˆ†å¸ƒ</h3><canvas id="c2"></canvas></div>
</div>
<h3 style="margin-bottom:15px">ğŸ“‹ è©³ç´°çµæœ</h3>
<div style="overflow-x:auto">
<table><thead><tr><th>ç¶²ç«™</th><th>ç‹€æ…‹</th><th>å‰©é¤˜å¤©æ•¸</th><th>åˆ°æœŸæ—¥</th><th>ä¸»é«”</th><th>ç™¼è¡Œè€…</th><th>é‡‘é‘°</th></tr></thead>
<tbody>$rows</tbody></table>
</div>
</div>
<div class="footer">SSL æ†‘è­‰æª¢æŸ¥å ±å‘Š v2.1 | è‡ªå‹•ç”¢ç”Ÿ</div>
</div>
<script>
new Chart(document.getElementById('c1'),{type:'doughnut',data:{labels:['å·²éæœŸ','å³å°‡éæœŸ','æ­£å¸¸','å¤±æ•—'],datasets:[{data:[$expired,$warning,$ok,$error],backgroundColor:['#ff6b6b','#feca57','#48dbfb','#a4b0be'],borderWidth:2,borderColor:'#fff'}]},options:{responsive:true,plugins:{legend:{position:'bottom'}}}});
new Chart(document.getElementById('c2'),{type:'bar',data:{labels:['å·²éæœŸ','7å¤©å…§','30å¤©å…§','90å¤©å…§','90å¤©+'],datasets:[{data:[$r1,$r2,$r3,$r4,$r5],backgroundColor:['#ff6b6b','#ffa502','#feca57','#48dbfb','#26de81']}]},options:{responsive:true,plugins:{legend:{display:false}},scales:{y:{beginAtZero:true,ticks:{stepSize:1}}}}});
</script>
</body>
</html>
"@
    [IO.File]::WriteAllText($Path, $html, [Text.Encoding]::UTF8)
}

# ==================== ä¸»ç¨‹å¼ ====================
$results = @()

foreach ($site in $websiteList) {
    Write-Host "Checking: $site" -ForegroundColor Yellow
    $info = Get-CertInfo -Url $site
    
    $color = switch ($info.Status) { 'OK' {'Green'} 'WARNING' {'Yellow'} 'EXPIRED' {'Red'} default {'Magenta'} }
    Write-Host "  Status: $($info.Status) | Days: $($info.DaysRemaining) | Subject: $($info.SubjectCN)" -ForegroundColor $color
    Write-Host ""
    
    $results += $info
    Start-Sleep -Milliseconds 500
}

# æ‘˜è¦
Write-Host "========================================" -ForegroundColor Cyan
Write-Host "Summary:" -ForegroundColor Cyan
Write-Host "  Total: $($results.Count)"
Write-Host "  Expired: $(($results|?{$_.Status -eq 'EXPIRED'}).Count)" -ForegroundColor Red
Write-Host "  Warning: $(($results|?{$_.Status -eq 'WARNING'}).Count)" -ForegroundColor Yellow
Write-Host "  OK: $(($results|?{$_.Status -eq 'OK'}).Count)" -ForegroundColor Green
Write-Host "  Error: $(($results|?{$_.Status -eq 'ERROR'}).Count)" -ForegroundColor Magenta
Write-Host "========================================" -ForegroundColor Cyan

# ç”¢ç”Ÿå ±å‘Š
$timestamp = Get-Date -Format 'yyyyMMdd_HHmmss'
$htmlFile = Join-Path $workingDir "ssl_report_$timestamp.html"
$csvFile = Join-Path $workingDir "ssl_results_$timestamp.csv"

Write-Host ""
Write-Host "Generating reports..." -ForegroundColor Gray

New-HtmlReport -Results $results -Path $htmlFile -Threshold $warningDays
Write-Host "HTML: $htmlFile" -ForegroundColor Green

$results | Select-Object Url,Status,DaysRemaining,SubjectCN,IssuerCN,@{N="ExpiryDate";E={$_.NotAfter.ToString('yyyy-MM-dd')}},KeySize,Thumbprint | Export-Csv -Path $csvFile -NoTypeInformation -Encoding UTF8
Write-Host "CSV: $csvFile" -ForegroundColor Green

# é–‹å•Ÿå ±å‘Š
try { Start-Process $htmlFile; Write-Host "Report opened in browser" -ForegroundColor Green } catch { Write-Host "Please open: $htmlFile" -ForegroundColor Yellow }

Write-Host ""
Write-Host "Done! Press any key to exit..." -ForegroundColor Cyan
$null = $Host.UI.RawUI.ReadKey("NoEcho,IncludeKeyDown")`;
}

function showStatus(msg, type) {
    const el = document.getElementById('statusMessage');
    el.textContent = msg;
    el.className = 'status-message status-' + type;
    el.style.display = 'block';
    setTimeout(() => el.style.display = 'none', 3000);
}

function validate() {
    const sites = document.getElementById('websites').value.trim();
    if (!sites) { showStatus('âŒ è«‹è¼¸å…¥è‡³å°‘ä¸€å€‹ç¶²ç«™', 'error'); return false; }
    return true;
}

function downloadScript() {
    if (!validate()) return;
    const blob = new Blob([generateScript()], { type: 'text/plain;charset=utf-8' });
    const link = document.createElement('a');
    link.href = URL.createObjectURL(blob);
    link.download = 'Check-SSL.ps1';
    link.click();
    URL.revokeObjectURL(link.href);
    showStatus('âœ… è…³æœ¬ä¸‹è¼‰æˆåŠŸï¼', 'success');
}

function copyScript() {
    if (!validate()) return;
    navigator.clipboard.writeText(generateScript()).then(() => {
        showStatus('âœ… å·²è¤‡è£½åˆ°å‰ªè²¼ç°¿ï¼', 'success');
    }).catch(() => {
        document.getElementById('scriptTextarea').value = generateScript();
        document.getElementById('scriptModal').style.display = 'block';
        showStatus('è«‹å¾è¦–çª—ä¸­æ‰‹å‹•è¤‡è£½', 'error');
    });
}

function viewScript() {
    if (!validate()) return;
    document.getElementById('scriptTextarea').value = generateScript();
    document.getElementById('scriptModal').style.display = 'block';
}

function closeModal() {
    document.getElementById('scriptModal').style.display = 'none';
}

function copyFromModal() {
    const ta = document.getElementById('scriptTextarea');
    ta.select();
    document.execCommand('copy');
    showStatus('âœ… å·²è¤‡è£½ï¼', 'success');
    closeModal();
}

window.onclick = e => { if (e.target.id === 'scriptModal') closeModal(); };
document.onkeydown = e => { if (e.key === 'Escape') closeModal(); };
    </script>
</body>
</html>

