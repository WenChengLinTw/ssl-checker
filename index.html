<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SSL æ†‘è­‰æª¢æŸ¥å·¥å…·ç”¢ç”Ÿå™¨ - ä¿®æ­£ç‰ˆ</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', 'Microsoft JhengHei', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 40px;
            text-align: center;
        }
        .header h1 { font-size: 36px; margin-bottom: 10px; }
        .header p { opacity: 0.9; font-size: 16px; }
        .content { padding: 40px; }
        .alert {
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 30px;
        }
        .alert-success {
            background: linear-gradient(135deg, #d4edda 0%, #a8e6cf 100%);
            border: 2px solid #28a745;
            color: #155724;
        }
        .alert-warning {
            background: linear-gradient(135deg, #fff3cd 0%, #ffeaa7 100%);
            border: 2px solid #ffc107;
            color: #856404;
        }
        .alert h3 { margin-bottom: 15px; font-size: 20px; }
        .alert ul { margin: 15px 0 15px 25px; }
        .alert li { margin: 8px 0; line-height: 1.6; }
        .features-section {
            background: #e8f5e8;
            padding: 30px;
            border-radius: 15px;
            margin-bottom: 30px;
            border: 2px solid #4caf50;
        }
        .features-section h2 { color: #2e7d32; margin-bottom: 20px; font-size: 28px; }
        .features-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
        }
        .feature-card {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            border-left: 5px solid #4caf50;
        }
        .feature-card h3 { color: #2e7d32; margin-bottom: 15px; font-size: 18px; }
        .feature-card ul { margin-left: 20px; }
        .feature-card li { margin: 8px 0; color: #388e3c; }
        .input-section {
            background: #f8f9fa;
            padding: 30px;
            border-radius: 15px;
            margin-bottom: 30px;
            border: 2px solid #e0e0e0;
        }
        .input-section h2 { color: #333; margin-bottom: 20px; font-size: 24px; }
        .form-group { margin-bottom: 25px; }
        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #555;
            font-weight: 600;
            font-size: 16px;
        }
        .form-group input, .form-group textarea {
            width: 100%;
            padding: 15px;
            border: 2px solid #ddd;
            border-radius: 10px;
            font-size: 14px;
            transition: all 0.3s;
        }
        .form-group textarea {
            resize: vertical;
            min-height: 150px;
            font-family: 'Courier New', monospace;
        }
        .form-group small {
            display: block;
            margin-top: 8px;
            color: #666;
            font-size: 13px;
        }
        .button-section {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }
        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 18px 30px;
            font-size: 16px;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
            font-weight: 600;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.6);
        }
        .btn:active {
            transform: translateY(0);
        }
        .btn-download {
            background: linear-gradient(135deg, #4caf50 0%, #45a049 100%);
            box-shadow: 0 4px 15px rgba(76, 175, 80, 0.4);
        }
        .btn-copy {
            background: linear-gradient(135deg, #2196F3 0%, #1976D2 100%);
            box-shadow: 0 4px 15px rgba(33, 150, 243, 0.4);
        }
        .status-message {
            padding: 15px 20px;
            border-radius: 10px;
            margin: 20px 0;
            display: none;
            font-weight: 500;
        }
        .status-success {
            background: #d4edda;
            border: 2px solid #c3e6cb;
            color: #155724;
        }
        .status-error {
            background: #f8d7da;
            border: 2px solid #f5c6cb;
            color: #721c24;
        }
        .footer {
            background: #f8f9fa;
            padding: 30px;
            text-align: center;
            color: #666;
            border-top: 2px solid #e0e0e0;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ”§ SSL æ†‘è­‰æª¢æŸ¥å·¥å…·ç”¢ç”Ÿå™¨</h1>
            <p>ç”¢ç”Ÿ PowerShell è…³æœ¬é€²è¡ŒçœŸå¯¦çš„ SSL æ†‘è­‰æª¢æŸ¥ + HTML å ±å‘Š</p>
        </div>
        <div class="content">
            <div class="alert alert-success">
                <h3>ğŸ‰ æ–°åŠŸèƒ½ï¼šHTML æ ¼å¼å ±å‘Š</h3>
                <ul>
                    <li><strong>ç¾è§€çš„è¦–è¦ºåŒ–å ±å‘Š</strong> - è‡ªå‹•ç”¢ç”Ÿç²¾ç¾çš„ HTML å ±å‘Šé é¢</li>
                    <li><strong>çµ±è¨ˆåœ–è¡¨</strong> - åŒ…å«çµ±è¨ˆæ‘˜è¦å’Œç‹€æ…‹æŒ‡ç¤ºå™¨</li>
                    <li><strong>è©³ç´°è³‡è¨Šå±•ç¤º</strong> - å®Œæ•´çš„æ†‘è­‰è³‡è¨Šå’Œåˆ°æœŸç‹€æ…‹</li>
                    <li><strong>è‡ªå‹•é–‹å•Ÿç€è¦½å™¨</strong> - æª¢æŸ¥å®Œæˆå¾Œè‡ªå‹•é–‹å•Ÿå ±å‘Š</li>
                </ul>
            </div>

            <div class="alert alert-warning">
                <h3>âš ï¸ é‡è¦èªªæ˜</h3>
                <ul>
                    <li><strong>ç¶²é ç‰ˆç„¡æ³•é€²è¡ŒçœŸå¯¦æ†‘è­‰æª¢æŸ¥</strong> - å—ç€è¦½å™¨å®‰å…¨é™åˆ¶</li>
                    <li><strong>æœ¬å·¥å…·å°ˆé–€ç”¨æ–¼ç”¢ç”Ÿ PowerShell è…³æœ¬</strong> - æä¾›çœŸå¯¦æº–ç¢ºçš„æ†‘è­‰æª¢æŸ¥</li>
                    <li><strong>è«‹ä¸‹è¼‰ä¸¦åŸ·è¡Œç”¢ç”Ÿçš„è…³æœ¬</strong> - ç²å¾—å®Œæ•´çš„æ†‘è­‰è³‡è¨Šå’Œ HTML å ±å‘Š</li>
                </ul>
            </div>

            <div class="features-section">
                <h2>ğŸš€ PowerShell è…³æœ¬åŠŸèƒ½ç‰¹è‰²</h2>
                <div class="features-grid">
                    <div class="feature-card">
                        <h3>ğŸ” çœŸå¯¦æ†‘è­‰æª¢æŸ¥</h3>
                        <ul>
                            <li>ç›´æ¥è®€å– SSL æ†‘è­‰è³‡è¨Š</li>
                            <li>æº–ç¢ºçš„åˆ°æœŸæ—¥æœŸå’Œå‰©é¤˜å¤©æ•¸</li>
                            <li>å®Œæ•´çš„æ†‘è­‰è©³ç´°è³‡è¨Š</li>
                            <li>æ”¯æ´æ‰€æœ‰ HTTPS ç¶²ç«™</li>
                        </ul>
                    </div>
                    <div class="feature-card">
                        <h3>ğŸ“Š HTML è¦–è¦ºåŒ–å ±å‘Š</h3>
                        <ul>
                            <li>ç²¾ç¾çš„éŸ¿æ‡‰å¼è¨­è¨ˆ</li>
                            <li>çµ±è¨ˆæ‘˜è¦å¡ç‰‡</li>
                            <li>é¡è‰²ç·¨ç¢¼ç‹€æ…‹æŒ‡ç¤º</li>
                            <li>è©³ç´°çš„æ†‘è­‰è³‡è¨Šè¡¨æ ¼</li>
                        </ul>
                    </div>
                    <div class="feature-card">
                        <h3>ğŸ“§ è‡ªå‹•è­¦å‘Šé€šçŸ¥</h3>
                        <ul>
                            <li>è‡ªå‹•ç™¼é€ Outlook éƒµä»¶</li>
                            <li>è‡ªè¨‚è­¦å‘Šå¤©æ•¸é–¾å€¼</li>
                            <li>è©³ç´°çš„è­¦å‘Šå ±å‘Šå…§å®¹</li>
                            <li>å‚™ç”¨æª”æ¡ˆé€šçŸ¥æ–¹å¼</li>
                        </ul>
                    </div>
                    <div class="feature-card">
                        <h3>ğŸ’¾ å¤šæ ¼å¼è¼¸å‡º</h3>
                        <ul>
                            <li>HTML å ±å‘Šï¼ˆæ–°åŠŸèƒ½ï¼‰</li>
                            <li>CSV æ ¼å¼å ±å‘Š</li>
                            <li>å½©è‰²æ§åˆ¶å°è¼¸å‡º</li>
                            <li>åŸ·è¡Œæ­·å²è¨˜éŒ„</li>
                        </ul>
                    </div>
                </div>
            </div>

            <div class="input-section">
                <h2>ğŸ“‹ è¨­å®šæª¢æŸ¥åƒæ•¸</h2>
                
                <div class="form-group">
                    <label for="websites">ç¶²ç«™æ¸…å–® (æ¯è¡Œä¸€å€‹ç¶²å€)</label>
                    <textarea id="websites" placeholder="è«‹è¼¸å…¥è¦æª¢æŸ¥çš„ç¶²ç«™ URLï¼Œæ¯è¡Œä¸€å€‹">https://esvc.fnp.gov.tw/
https://www.fnp.gov.tw/
https://webjop.fnp.gov.tw/
https://pts.fnp.gov.tw/APNPA/
https://pms.fnp.gov.tw/
https://iesextmail1.fnp.gov.tw/</textarea>
                    <small>è«‹è¼¸å…¥å®Œæ•´çš„ URLï¼ŒåŒ…å« https://ã€‚æ¯è¡Œä¸€å€‹ç¶²å€ï¼Œæ”¯æ´ä»»æ„æ•¸é‡çš„ç¶²ç«™ã€‚</small>
                </div>
                
                <div class="form-group">
                    <label for="warningDays">è­¦å‘Šå¤©æ•¸é–¾å€¼</label>
                    <input type="number" id="warningDays" value="60" min="1" max="365">
                    <small>ç•¶æ†‘è­‰å‰©é¤˜å¤©æ•¸å°‘æ–¼æ­¤å€¼æ™‚ï¼Œæœƒç™¼å‡ºè­¦å‘Šé€šçŸ¥ã€‚å»ºè­°è¨­å®šç‚º 30-90 å¤©ã€‚</small>
                </div>
                
                <div class="form-group">
                    <label for="emailRecipient">è­¦å‘Šéƒµä»¶æ”¶ä»¶äºº</label>
                    <input type="email" id="emailRecipient" value="wencheng.tw@gmail.com" placeholder="your-email@example.com">
                    <small>ç”¨æ–¼æ¥æ”¶æ†‘è­‰åˆ°æœŸè­¦å‘Šçš„é›»å­éƒµä»¶åœ°å€ã€‚è…³æœ¬æœƒå˜—è©¦é€é Outlook è‡ªå‹•ç™¼é€éƒµä»¶ã€‚</small>
                </div>

                <div class="button-section">
                    <button class="btn btn-download" id="downloadBtn">
                        <span>ğŸ“¥</span>
                        ä¸‹è¼‰ PowerShell è…³æœ¬
                    </button>
                    <button class="btn btn-copy" id="copyBtn">
                        <span>ğŸ“‹</span>
                        è¤‡è£½è…³æœ¬å…§å®¹
                    </button>
                </div>

                <div id="statusMessage" class="status-message"></div>
            </div>
        </div>
        
        <div class="footer">
            <p>Â© 2025 SSL æ†‘è­‰æª¢æŸ¥å·¥å…·ç”¢ç”Ÿå™¨ | å°ˆæ¥­çš„æ†‘è­‰ç›£æ§è§£æ±ºæ–¹æ¡ˆ</p>
            <p>ä½¿ç”¨ PowerShell æŠ€è¡“æä¾›æº–ç¢ºå¯é çš„æ†‘è­‰æª¢æŸ¥æœå‹™ + ç²¾ç¾çš„ HTML å ±å‘Š</p>
        </div>
    </div>
    <script>
        // PowerShell è…³æœ¬æ¨¡æ¿
        function getScriptTemplate() {
            return `# SSL Certificate Check Script
# Auto-generated

param(
    [string]$OutputHtml = "ssl-report.html",
    [string]$OutputCsv = "ssl-report.csv"
)

$websites = @(
{WEBSITES}
)
$warningDays = {WARNING_DAYS}
$emailRecipient = "{EMAIL}"

$workingDir = if ($PSScriptRoot) { $PSScriptRoot } else { "D:\\\\chkSSL" }
if (-not (Test-Path $workingDir)) { New-Item -ItemType Directory -Path $workingDir -Force | Out-Null }

$OutputHtml = Join-Path $workingDir $OutputHtml
$OutputCsv = Join-Path $workingDir $OutputCsv

function Get-SSLCertificate {
    param([string]$Url, [int]$WarningDays)
    try {
        $uri = [System.Uri]$Url
        $hostname = $uri.Host
        $port = if ($uri.Port -eq -1) { 443 } else { $uri.Port }
        
        $tcpClient = New-Object System.Net.Sockets.TcpClient
        $tcpClient.Connect($hostname, $port)
        $sslStream = New-Object System.Net.Security.SslStream($tcpClient.GetStream(), $false, { $true })
        $sslStream.AuthenticateAsClient($hostname)
        
        $cert = New-Object System.Security.Cryptography.X509Certificates.X509Certificate2($sslStream.RemoteCertificate)
        $daysRemaining = ($cert.NotAfter - (Get-Date)).Days
        
        $status = if ($daysRemaining -le 0) { "EXPIRED" } elseif ($daysRemaining -le $WarningDays) { "WARNING" } else { "OK" }
        
        $sslStream.Close()
        $tcpClient.Close()
        
        return [PSCustomObject]@{
            Url = $Url
            Hostname = $hostname
            Status = $status
            DaysRemaining = $daysRemaining
            Subject = $cert.Subject
            Issuer = $cert.Issuer
            ValidFrom = $cert.NotBefore.ToString("yyyy-MM-dd")
            ExpiryDate = $cert.NotAfter.ToString("yyyy-MM-dd")
        }
    } catch {
        return [PSCustomObject]@{
            Url = $Url; Status = "ERROR"; DaysRemaining = 0
            Subject = "N/A"; Issuer = "N/A"; ValidFrom = "N/A"; ExpiryDate = "N/A"
        }
    }
}

Write-Host "Checking SSL Certificates..." -ForegroundColor Cyan
$results = @()
foreach ($website in $websites) {
    Write-Host "Checking: $website" -ForegroundColor Yellow
    $results += Get-SSLCertificate -Url $website -WarningDays $warningDays
}

$results | Export-Csv -Path $OutputCsv -NoTypeInformation -Encoding UTF8
Write-Host "CSV saved: $OutputCsv" -ForegroundColor Green

$expired = ($results | Where-Object { $_.Status -eq 'EXPIRED' }).Count
$warning = ($results | Where-Object { $_.Status -eq 'WARNING' }).Count
$ok = ($results | Where-Object { $_.Status -eq 'OK' }).Count

$html = @"
<!DOCTYPE html>
<html><head><meta charset="UTF-8"><title>SSL Report</title>
<style>
body{font-family:Arial;background:#667eea;padding:20px}
.container{max-width:1200px;margin:0 auto;background:white;border-radius:15px;padding:30px}
.summary{display:grid;grid-template-columns:repeat(3,1fr);gap:20px;margin:20px 0}
.card{padding:20px;border-radius:10px;text-align:center;color:white}
.card h2{font-size:40px;margin:0}
.expired{background:#ff4757}.warning{background:#ffa502}.ok{background:#26de81}
table{width:100%;border-collapse:collapse;margin-top:20px}
th{background:#667eea;color:white;padding:12px}
td{padding:10px;border-bottom:1px solid #ddd}
.badge{padding:5px 10px;border-radius:15px;color:white;font-size:12px}
</style></head><body>
<div class="container">
<h1>ğŸ”’ SSL Certificate Report</h1>
<p>Check Time: $(Get-Date -Format 'yyyy-MM-dd HH:mm:ss')</p>
<div class="summary">
<div class="card expired"><h2>$expired</h2><p>Expired</p></div>
<div class="card warning"><h2>$warning</h2><p>Warning</p></div>
<div class="card ok"><h2>$ok</h2><p>OK</p></div>
</div>
<table><thead><tr><th>Website</th><th>Status</th><th>Days</th><th>Expiry Date</th></tr></thead><tbody>
"@

foreach ($r in $results) {
    $badge = switch($r.Status){"EXPIRED"{"expired"};"WARNING"{"warning"};"OK"{"ok"};default{"expired"}}
    $html += "<tr><td>$($r.Url)</td><td><span class='badge $badge'>$($r.Status)</span></td><td>$($r.DaysRemaining)</td><td>$($r.ExpiryDate)</td></tr>"
}

$html += "</tbody></table></div></body></html>"
[System.IO.File]::WriteAllText($OutputHtml, $html, [System.Text.Encoding]::UTF8)

Write-Host "HTML saved: $OutputHtml" -ForegroundColor Green
Start-Process $OutputHtml
Write-Host "Done! Press any key..." -ForegroundColor Cyan
$null = $Host.UI.RawUI.ReadKey("NoEcho,IncludeKeyDown")
`;
        }

        function generateScript() {
            const websites = document.getElementById('websites').value.trim().split('\n').filter(u => u.trim());
            const warningDays = document.getElementById('warningDays').value;
            const email = document.getElementById('emailRecipient').value.trim();
            
            if (websites.length === 0) {
                showStatus('è«‹è¼¸å…¥è‡³å°‘ä¸€å€‹ç¶²ç«™ URL', 'error');
                return null;
            }
            
            const websitesArray = websites.map(url => `    "${url.trim()}"`).join(',\n');
            let script = getScriptTemplate();
            script = script.replace('{WEBSITES}', websitesArray);
            script = script.replace('{WARNING_DAYS}', warningDays);
            script = script.replace('{EMAIL}', email);
            return script;
        }
        
        function showStatus(message, type) {
            const statusDiv = document.getElementById('statusMessage');
            statusDiv.textContent = message;
            statusDiv.className = 'status-message status-' + type;
            statusDiv.style.display = 'block';
            setTimeout(() => { statusDiv.style.display = 'none'; }, 5000);
        }
        
        document.getElementById('downloadBtn').addEventListener('click', function() {
            const script = generateScript();
            if (!script) return;
            
            const blob = new Blob([script], { type: 'text/plain;charset=utf-8' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'Check-SSLCertificates.ps1';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            window.URL.revokeObjectURL(url);
            
            showStatus('âœ… PowerShell è…³æœ¬å·²ä¸‹è¼‰æˆåŠŸï¼', 'success');
        });
        
        document.getElementById('copyBtn').addEventListener('click', function() {
            const script = generateScript();
            if (!script) return;
            
            navigator.clipboard.writeText(script).then(() => {
                showStatus('âœ… è…³æœ¬å…§å®¹å·²è¤‡è£½åˆ°å‰ªè²¼ç°¿ï¼', 'success');
            }).catch(err => {
                showStatus('âŒ è¤‡è£½å¤±æ•—ï¼š' + err.message, 'error');
            });
        });
    </script>
</body>
</html>
</body>
</html>`;
        }
